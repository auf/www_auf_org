{% load sekizai_tags staticfiles %}

{% addtoblock "js" %}
<script type="text/javascript" src="{% static "js/d3.v3.min.js" %}"></script>
<script type="text/javascript" src="{% static "js/topojson.v1.min.js" %}"></script>
<script type="text/javascript" src="{% static "js/datamaps.world.min.js" %}"></script>
<script>
    var map = new Datamap({
    element: document.getElementById("carte"),
    responsive: true,
    dataUrl: '{% url "cmsplugin_carte-pays_json" %}',
    data: {},

    done: function(datamap) {
        datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {
            window.open('http://www.auf.org/' + datamap.options.data[geography.id].fillKey.toLowerCase())
        });
    },

    geographyConfig: {
      highlightOnHover: true,
      popupOnHover: true,
      borderColor:'#FFF',
      borderWidth: 0.5,
      popupTemplate: function(geo, data) {
          $('#adresse').html(datamap.options.data[geography.id].adresse_physique);
          return ['<div class="hoverinfo"><strong>', data.options.data[geography.id].fillKey.toLowerCase(), '</strong></div>'].join('');
      }
   },

   fills: {
              'BA':'#34AB92',
              'BACGL':'#F7AB00',
              'BAO': '#65B22E',
              'BAP': '#9F72AE',
              'BC': '#601D52',
              'BECO': '#73D0F5',
              'BEO': '#EA560D',
              'BM': '#B49B5A',
              'BMO': '#387DC0',
              'BOI': '#EE79AD',
               defaultFill: '#AAA'
            }
    });

    window.addEventListener('resize', function() {
        map.resize();
    });

 $.getJSON('{% url "cmsplugin_carte-bureaux_json" %}', function(points) {
        map.bubbles(points, {
            borderWidth: 1,
            popupOnHover: true,
            highlightOnHover: true,
            borderColor: '#000',
            popupTemplate: function (geo, data) {
              return '<div class="hoverinfo"><strong>' +  data.nom  + '</strong></div>';
            }
        });
 }).fail(function( jqxhr, textStatus, error ) {
    var err = textStatus + ", " + error;
    console.log( "Request Failed: " + err );
});

//Legende
    map.legend();
</script>

{% endaddtoblock %}


<h3 class="page_title">L'AUF dans le monde</h3>

<div id="carte"></div>
<div id="adresse"></div>
